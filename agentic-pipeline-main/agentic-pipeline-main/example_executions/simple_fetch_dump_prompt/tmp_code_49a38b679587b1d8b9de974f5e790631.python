import requests
import json
import mysql.connector

def fetch_and_store_posts(url, db_config, table_name):
  """Fetches the first 10 posts from the given URL and stores them in a MySQL database.

  Args:
      url (str): The base URL of the API.
      db_config (dict): A dictionary containing MySQL database connection details.
      table_name (str): The name of the table to store the data in.
  """

  posts = []
  for i in range(1, 11):
    post_url = f"{url}/{i}"
    response = requests.get(post_url)

    if response.status_code == 200:
      posts.append(response.json())
    else:
      print(f"Error fetching post {i}: {response.status_code}")

  # Connect to the database
  try:
    cnx = mysql.connector.connect(**db_config)
    cursor = cnx.cursor()

    # Create the table if it doesn't exist
    create_table_sql = f"""
    CREATE TABLE IF NOT EXISTS {table_name} (
        id INT PRIMARY KEY,
        userId INT,
        title VARCHAR(255),
        body TEXT
    )
    """
    cursor.execute(create_table_sql)

    # Insert data into the table
    insert_sql = f"INSERT INTO {table_name} (id, userId, title, body) VALUES (%s, %s, %s, %s)"
    for post in posts:
      cursor.execute(insert_sql, (post['id'], post['userId'], post['title'], post['body']))

    cnx.commit()
    print(f"Data successfully stored in table '{table_name}'")
  except mysql.connector.Error as err:
    print(f"Error connecting to database or inserting data: {err}")
  finally:
    if cnx:
      cursor.close()
      cnx.close()

# Replace with your database connection details
db_config = {
  'host': 'sql12.freesqldatabase.com',
  'user': 'sql12733760',
  'password': 'f38dvE5qEB',
  'database': 'sql12733760',
  'port': 3306
}

# Replace with your desired table name
table_name = 'posts'

# Fetch and store posts
fetch_and_store_posts("https://jsonplaceholder.typicode.com/posts", db_config, table_name)